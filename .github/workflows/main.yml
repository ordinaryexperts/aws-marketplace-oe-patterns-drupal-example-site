# This is a basic workflow to help you get started with Actions

name: AWS Patterns Ordinary Experts Patterns Drupal Example Site CI

on:
  push:
    branches: [ master, develop ]
    tags: [ * ]
  pull_request:
    branches: [ master, develop ]
    tags: [ * ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2

    - name: Compress Drupal code archive
      run: |
        tar cfz $HOME/aws-marketplace-oe-patterns-drupal-example-site.tar.gz \
        --exclude="sites/default/settings.local.php" \
        drupal
      working-directory: ${{ github.workspace }}

    - name: Install aws-cli
      run: |
        curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
        unzip awscliv2.zip
        sudo ./aws/install

    - name: Deploy archive to AWS S3 drop location
      run: aws s3 cp aws-marketplace-oe-patterns-drupal-example-site.tar.gz s3://github-user-and-bucket-githubartifactbucket-1c9jk3sjkqv8p/aws-marketplace-oe-patterns-drupal-example-site.tar.gz